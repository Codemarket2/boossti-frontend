// MUI
import Paper from '@mui/material/Paper';
import Stack from '@mui/material/Stack';
import MaterialButton from '@mui/material/Button';

// OTHERS
import { useEditor, useNode } from '@craftjs/core';

// CRAFTJS - WEB
import Button from './components/Button';
import Container from './components/Container';
import FormDisplay from './components/Form/FormDisplay';
import useGetFormList, { TFormListData } from './libs/hooks/useGetFormList';
import ComponentPropEditor from './ComponentPropEditor';
import PanelSection from './PanelSection';
import Grid from '@mui/material/Grid';
import Box from '@mui/material/Box';

interface TBOptionProps {
  text: string;
  component: React.ReactElement;
}

const TBOption = ({ text, component }: TBOptionProps) => {
  const { connectors } = useEditor();
  return (
    <MaterialButton ref={(ref) => connectors.create(ref, component)} variant="contained">
      {text}
    </MaterialButton>
  );
};

const FormSearch = () => {
  const [data, error, loading] = useGetFormList();

  if (loading) return <div>Loading Forms...</div>;

  if (error) return <div>Error while loading the forms...</div>;

  return (
    <Stack spacing={1}>
      {(data as TFormListData).getForms.data.map((val, idx) => {
        return (
          <TBOption
            key={idx}
            text={`Form - ${val.name}`}
            component={
              <FormDisplay
                settings={{
                  widgetType: 'form',
                }}
                formId={val._id}
              />
            }
          />
        );
      })}
    </Stack>
  );
};

const FormSection = () => {
  return (
    <PanelSection title="Form">
      <FormSearch />
    </PanelSection>
  );
};

const ComponentsSection = () => {
  return (
    <PanelSection title="Components">
      <Stack spacing={1}>
        <TBOption text="Button - Hi!!!" component={<Button text="Hi!!!!" />} />
        <TBOption text="Button - Bye!!!" component={<Button text="Bye!!!!" />} />
        <TBOption text="Container" component={<Container />} />
      </Stack>
    </PanelSection>
  );
};

const EditCompPropSection = () => {
  const { isCompSelected } = useEditor((state) => {
    return {
      isCompSelected: Boolean(state.events.selected.size),
    };
  });

  if (!isCompSelected) return null;

  return (
    <PanelSection title="Edit Component Prop">
      <ComponentPropEditor />
    </PanelSection>
  );
};

const ReactGridLayoutLeftPanel = () => {
  // useEffect(() => {
  //   console.log(data);
  //   // debugger;
  // }, [data]);

  return (
    <Box style={{ width: '100%' }}>
      <Grid container spacing={2} className={classes.container}>
        <Grid item md={6} xs={12}>
          <Box className={classes.centerElement}>
            <Typography variant="h2" component="h2" gutterBottom>
              Choose Microsoft Edge for AI-powered
            </Typography>

            <Button variant="outlined" className={classes.button}>
              Try Edge
            </Button>
          </Box>
        </Grid>
        <Grid item md={6} xs={12}>
          <img
            style={{
              width: '80%',
              height: '50%',
              marginTop: '20vh',

              marginLeft: '5vw',
              marginRight: '5vw',
            }}
            src="https://edgestatic.azureedge.net/shared/cms/lrs1c69a1j/section-images/e2258d06158940118ce733c03dbf26cf.jpg"
            alt="somthing"
          />
        </Grid>
      </Grid>
    </Box>
  );
};

export default ReactGridLayoutLeftPanel;
